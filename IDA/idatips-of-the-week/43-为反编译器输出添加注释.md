上周我们开始改进一个简单函数的反编译结果。 虽然通过重命名和重新定义类型可以走得很远，但有些情况需要比简单重命名更详细的解释。

### 注释（Comments）

当你无法为变量或函数想出一个好名字时，可以添加注释来解释或记录你对其作用的推测。 在伪代码中可用的注释类型有：

1. 普通行尾注释

   - 使用 `/` 添加或编辑（容易记住，因为在 C++ 中 `//` 用于注释）。

   ![](assets/2021/06/hr-comment1.png)

2. 块注释

   - 类似于反汇编视图中的前置注释（`anterior comments`），使用 `Ins`（Mac 上为 `I`）添加。 注释会添加在当前语句之前（不一定是当前行）。

   ![](assets/2021/06/hr-comment2.png)

3. 函数注释

   - 在函数第一行使用 / 添加。

   ![](assets/2021/06/hr-comment3.png)

由于实现上的限制，前两种注释在伪代码变化时可能会移动，甚至变成孤立注释。 函数注释是附加在函数本身上的，也会在反汇编视图中显示。

利用注释，我们可以为上一篇文章中的函数添加说明，帮助理解其作用。 在下图中，普通注释用蓝色高亮，块注释用橙色边框标出。

![](assets/2021/06/hr-comment4.png)

最终，这个函数似乎是从 `a2` 向 `a1` 复制字节，遇到第一个零字节时停止。 如果你熟悉 `libc`，会很快意识到它其实是 `strcpy` 的一个简单实现。

![](assets/2021/06/hr-comment5.png)

此时我们可以将函数和参数重命名为标准名称，并添加函数注释说明其用途。 不过，已有的注释不会自动更新，因此其中提到 `a1` 和 `a2` 的地方需要手动修改。

### 空行（Empty lines）

为了进一步提高伪代码的可读性，你可以手动或自动添加空行。

**手动添加**：在语句前或后按 `Enter`。

例如，下面是同一个函数，添加了额外的空行：

![](assets/2021/06/hr-comment6.png)

**删除手动空行**：编辑前置注释（Ins 或 Mac 上的 I），删除其中的空行。

**自动添加**：在 `hexrays.cfg` 中设置

```bash
GENERATE_EMPTY_LINES = YES
```

这样反编译器会在复合语句之间以及标签前添加空行。 对于长函数或复杂函数，这能显著提升可读性。

例如，下图展示了同一个函数在两种设置下的反编译结果，可以看到第二种因为额外的空行而更易阅读。

![](assets/2021/06/hr-empty1.png)

![](assets/2021/06/hr-empty2.png)

原文地址：https://hex-rays.com/blog/igors-tip-of-the-week-43-annotating-the-decompiler-output
