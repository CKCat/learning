在 IDA 中，数组用于表示一系列相同类型的多个元素：

- 基本类型（byte、word、dword 等）
- 复杂类型（例如结构体）

### 创建数组

1. 创建第一个元素；
1. 从右键菜单中选择 `Array…` 或按 `*`；
1. 至少填写 `Array size`（数组大小）字段，然后点击 OK。

第 1 步是可选的；如果当前位置没有数据项，将创建一个字节数组。

如果在按 `*` 之前先选中一个范围，`Array size` 会自动填入该范围内可容纳的元素数量。

### 数组参数

数组参数会影响数组在反汇编列表中的显示方式，可以在创建数组时设置，也可以随时按 `*` 修改。

![](assets/2020/10/array_params.png)

- `Array size`：数组的总元素数。
- `Items on a line`：每行显示的最大元素数。
  - 0 表示在一行中显示尽可能多的元素（取决于反汇编行宽）。
- `Element print width`：每个元素占用的字符数。
  - 配合上一项可将数组格式化为整齐的表格。

示例（8 个元素/行）：

print width -1：

```
db 1, 2, 3, 4, 5, 6, 7, 8
db 9, 10, 11, 12, 13, 14, 15, 16
db 17, 18, 19, 20, 21, 22, 23, 24
db 25, 255, 255, 255, 255, 255, 255, 26
db 27, 28, 29, 30, 31, 32, 33, 34
db 35, 36, 37, 38, 39, 40, 41, 42
```

print width 0：

```
db   1,  2,  3,  4,  5,  6,  7,  8
db   9, 10, 11, 12, 13, 14, 15, 16
db  17, 18, 19, 20, 21, 22, 23, 24
db  25,255,255,255,255,255,255, 26
db  27, 28, 29, 30, 31, 32, 33, 34
db  35, 36, 37, 38, 39, 40, 41, 42
```

print width 5：

```
db     1,    2,    3,    4,    5,    6,    7,    8
db     9,   10,   11,   12,   13,   14,   15,   16
db    17,   18,   19,   20,   21,   22,   23,   24
db    25,  255,  255,  255,  255,  255,  255,   26
db    27,   28,   29,   30,   31,   32,   33,   34
db    35,   36,   37,   38,   39,   40,   41,   42
```

**使用 dup 构造**

对于支持该语法的汇编器，重复的相同值会被折叠为 `dup` 表达式，而不是逐个打印：

dup off：

```
db 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh
```

dup on：

```
db 6 dup(0FFh)
```

**其他参数**

- `Signed elements`：将整数元素视为有符号数。
- `Display indexes`：在每行的注释中显示该行第一个元素的数组索引。
- `Create as array`：如果取消勾选，IDA 会将数组转换为单独的元素。

### 创建多个字符串字面量

数组参数对话框中的最后一个选项在处理多个连续存放的字符串时很有用。

例如，有一个字符串表：

![](assets/2020/10/strarray1-e1602241530916.png)

先创建第一个字符串。

![](assets/2020/10/strarray2-e1602241558294.png)

选中它以及后续所有字符串（可用之前介绍的[选区](https://www.hex-rays.com/blog/igor-tip-of-the-week-04-more-selection)方法）。

![](assets/2020/10/strarray3-e1602241577448.png)

执行 `Edit > Array…` 或按 `*`，`Array size` 会自动设置为选区的总长度，在对话框中取消勾选 `Create as array`，点击 OK。

![](assets/2020/10/strarray4-268x300.png)

这样就能得到一个格式整齐的字符串表。

![](assets/2020/10/strarray5-e1602241689700.png)

该方法同样适用于 Unicode（UTF-16）字符串。

原文地址：https://hex-rays.com/blog/igor-tip-of-the-week-10-working-with-arrays
